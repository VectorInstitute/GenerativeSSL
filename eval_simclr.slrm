#!/bin/bash

#SBATCH --job-name=train_sunrgbd
#SBATCH --partition=t4v2
#SBATCH --time=12:00:00
#SBATCH --nodes=1
#SBATCH --gres=gpu:4
#SBATCH --ntasks-per-node=4
#SBATCH --cpus-per-task=4
#SBATCH --mem-per-cpu=2G
#SBATCH --output=./runs/eval_slurm-%N-%j.out
#SBATCH --error=./runs/eval_slurm-%N-%j.err
#SBATCH --qos=m

PY_ARGS=${@:1}

# load virtual environment
source /ssd003/projects/aieng/envs/genssl/bin/activate

export NCCL_ASYNC_ERROR_HANDLING=1 # set to 1 for NCCL backend
export CUDA_LAUNCH_BLOCKING=1

export MASTER_ADDR=$(hostname)
export MASTER_PORT=45679

export PYTHONPATH="."
nvidia-smi

# “srun” executes the script <ntasks-per-node * nodes> times
srun python evaluate_simCLR.py \
--distributed_mode \
--batch-size=256 \
--pretrained_model_dir="/ssd003/projects/aieng/genssl/experiments/simclr" \
--pretrained_model_name="/checkpoint_epoch_0003.pth.tar" \
--linear_evaluation 